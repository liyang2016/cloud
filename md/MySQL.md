存在排序时，最好在排序字段上创建索引，否则会产生filesort操作

redolog undolog binlog

1. redolog日志
InnoDB存储引擎层的日志，重做日志，保证数据库事务执行过程中崩溃时，可以恢复到崩溃之前。
采用Write Ahead Logging策略，在数据库更新时，先将更新操作记录到日志中，然后并发的更新到磁盘中
2. undolog日志
主要用来做事务回滚和MVCC
3. binlog日志
MySQL Server层记录的日志，记录所有更新且提交了数据或者已经在更新提交了的数据的所有语句，作为主从复制使用

4. 总结
由于事务的原子性，需要保证事务提交时，redolog与binlog都写入成功，update语句执行的过程：
update person set age = 30 where id = 1;
a. 分配事务ID，获取锁，没有获取锁则等待。
b. 执行器先通过存储引擎找到id = 1的数据也


###read_only属性
show variables like '%read_only%';
set global read_only=1;   ---设置read_only属性为ON 0则为OFF
flush tables with read lock;   ---提交所有的锁操作
当read_only属性为ON时，非super用户执行DML语句时，会报异常


### type类型
|  ALL              |  全表扫描

|  index            |  索引全扫描

|  range            |  索引范围扫描，常用语<,<=,>=,between等操作

|  ref                |  使用非唯一索引扫描或唯一索引前缀扫描，返回单条记录，常出现在关联查询中

|  eq_ref           |  类似ref，区别在于使用的是唯一索引，使用主键的关联查询

|  const/system  |  单条记录，系统会把匹配行中的其他列作为常数处理，如主键或唯一索引查询

|  null                |  MySQL不访问任何表或索引，直接返回结果
由上至下，效率越来越高

### 实例
表ins_audit_item中包含50万条数据，存储引擎InnoDB
```shell
mysql> show create table ins_audit_item;
+----------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table          | Create Table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+----------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ins_audit_item | CREATE TABLE `ins_audit_item` (
  `ins_audit_item_id` bigint(20) NOT NULL,
  `ins_audit_id` bigint(20) DEFAULT NULL,
  `audit_item_id` bigint(20) DEFAULT NULL,
  `audit_item_name` varchar(255) DEFAULT NULL,
  `busi_ins_id` bigint(20) DEFAULT NULL,
  `busi_id` bigint(20) DEFAULT NULL,
  `busi_name` varchar(255) DEFAULT NULL,
  `busi_oper_id` bigint(20) DEFAULT NULL,
  `busi_oper_name` varchar(255) DEFAULT NULL,
  `audit_result` int(4) DEFAULT NULL,
  `state` tinyint(2) DEFAULT NULL,
  `create_date` datetime DEFAULT NULL,
  `deal_oper` bigint(20) DEFAULT NULL,
  `done_date` datetime DEFAULT NULL,
  PRIMARY KEY (`ins_audit_item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
+----------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
mysql> select * from ins_audit_item where state=1 order by ins_audit_item_id desc limit 10,10;
+-------------------+--------------+---------------+-----------------+-------------+---------+-----------+--------------+----------------+--------------+-------+---------------------+-----------+-----------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id | busi_id | busi_name | busi_oper_id | busi_oper_name | audit_result | state | create_date         | deal_oper | done_date |
+-------------------+--------------+---------------+-----------------+-------------+---------+-----------+--------------+----------------+--------------+-------+---------------------+-----------+-----------+
|            690291 |       290313 |          8344 | 经办人身份证件  |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690290 |       290313 |          8345 | 业务协议        |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690289 |       290312 |          8342 | 客户有效证件    |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690288 |       290312 |          8343 | 经办人授权书    |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690287 |       290312 |          8344 | 经办人身份证件  |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690286 |       290312 |          8345 | 业务协议        |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:11 |      NULL | NULL      |
|            690285 |       290311 |          8342 | 客户有效证件    |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:10 |      NULL | NULL      |
|            690284 |       290311 |          8343 | 经办人授权书    |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:10 |      NULL | NULL      |
|            690283 |       290311 |          8344 | 经办人身份证件  |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:10 |      NULL | NULL      |
|            690282 |       290311 |          8345 | 业务协议        |        NULL |    NULL | NULL      |         NULL | NULL           |            0 |     1 | 2019-03-11 02:43:10 |      NULL | NULL      |
+-------------------+--------------+---------------+-----------------+-------------+---------+-----------+--------------+----------------+--------------+-------+---------------------+-----------+-----------+
10 rows in set (0.00 sec)

mysql> show profile;
+--------------------+----------+
| Status             | Duration |
+--------------------+----------+
| starting           | 0.000040 |
| Opening tables     | 0.000007 |
| System lock        | 0.000001 |
| Table lock         | 0.000003 |
| init               | 0.000015 |
| optimizing         | 0.000004 |
| statistics         | 0.000005 |
| preparing          | 0.000004 |
| executing          | 0.000002 |
| Sorting result     | 0.000001 |
| Sending data       | 0.000096 |
| end                | 0.000002 |
| query end          | 0.000001 |
| freeing items      | 0.000249 |
| logging slow query | 0.000001 |
| cleaning up        | 0.000002 |
+--------------------+----------+
16 rows in set (0.00 sec)

mysql> select * from ins_audit_item where state=1 order by ins_audit_item_id desc limit 500000,10;
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name         | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
|            175499 |       115705 |          1472 | 客户需求单      | 20171102308428 |  200133 | 集团代付(GSM语音) |       200134 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:48 |     10009283 | 2017-11-24 15:17:23 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网            |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
10 rows in set (0.66 sec)

mysql> show profile;
+--------------------+----------+
| Status             | Duration |
+--------------------+----------+
| starting           | 0.000039 |
| Opening tables     | 0.000008 |
| System lock        | 0.000001 |
| Table lock         | 0.000002 |
| init               | 0.000017 |
| optimizing         | 0.000004 |
| statistics         | 0.000005 |
| preparing          | 0.000004 |
| executing          | 0.000001 |
| Sorting result     | 0.000001 |
| Sending data       | 0.660939 |
| end                | 0.000025 |
| query end          | 0.000003 |
| freeing items      | 0.000271 |
| logging slow query | 0.000001 |
| cleaning up        | 0.000002 |
+--------------------+----------+
16 rows in set (0.00 sec)
mysql> alter table ins_audit_item add index state(state,ins_audit_item_id);
Query OK, 541309 rows affected (6.26 sec)
Records: 541309  Duplicates: 0  Warnings: 0

mysql> select * from ins_audit_item where state=1 order by ins_audit_item_id desc limit 500000,10;
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name         | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
|            175499 |       115705 |          1472 | 客户需求单      | 20171102308428 |  200133 | 集团代付(GSM语音) |       200134 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:48 |     10009283 | 2017-11-24 15:17:23 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网            |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
10 rows in set (1.40 sec)

mysql> show profile;
+--------------------+----------+
| Status             | Duration |
+--------------------+----------+
| starting           | 0.000046 |
| Opening tables     | 0.000378 |
| System lock        | 0.000002 |
| Table lock         | 0.000004 |
| init               | 0.000020 |
| optimizing         | 0.000006 |
| statistics         | 0.000050 |
| preparing          | 0.000008 |
| executing          | 0.000000 |
| Sorting result     | 0.000002 |
| Sending data       | 1.401836 |
| end                | 0.000003 |
| query end          | 0.000001 |
| freeing items      | 0.000325 |
| logging slow query | 0.000001 |
| cleaning up        | 0.000002 |
+--------------------+----------+
16 rows in set (0.00 sec)

mysql> select * from ins_audit_item where state=1 order by create_date desc limit 500000,10;
+-------------------+--------------+---------------+-----------------+----------------+---------+----------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name      | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+---------+----------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
|            175500 |       115706 |          1402 | 客户需求单      | 20171102310401 |  200233 | 物联网         |       200269 | 成员维护                                     |            2 |     1 | 2017-11-02 14:50:48 |       730526 | 2017-11-16 15:20:59 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网         |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线 |       200189 | 业务变更（除带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
+-------------------+--------------+---------------+-----------------+----------------+---------+----------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
10 rows in set (2.34 sec)

mysql> select * from ins_audit_item where state=1 order by create_date desc,ins_audit_item_id desc limit 500000,10;
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name         | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
|            175499 |       115705 |          1472 | 客户需求单      | 20171102308428 |  200133 | 集团代付(GSM语音) |       200134 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:48 |     10009283 | 2017-11-24 15:17:23 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网            |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
10 rows in set (2.35 sec)

mysql> alter table ins_audit_item add index create_date_index(state,create_date);
Query OK, 541309 rows affected (6.49 sec)
Records: 541309  Duplicates: 0  Warnings: 0

mysql> select * from ins_audit_item where state=1 order by create_date desc,ins_audit_item_id desc limit 500000,10;
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name         | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
|            175499 |       115705 |          1472 | 客户需求单      | 20171102308428 |  200133 | 集团代付(GSM语音) |       200134 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:48 |     10009283 | 2017-11-24 15:17:23 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网            |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+
10 rows in set (1.43 sec)

mysql> select * from ins_audit_item where ins_audit_item_id >= (select ins_audit_item_id from ins_audit_item where state=1 order by create_date,ins_audit_item_id limit 500000,1) limit 10;
+-------------------+--------------+---------------+-----------------+----------------+--------------+------------------------+--------------+----------------+--------------+-------+---------------------+-----------+---------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id      | busi_name              | busi_oper_id | busi_oper_name | audit_result | state | create_date         | deal_oper | done_date           |
+-------------------+--------------+---------------+-----------------+----------------+--------------+------------------------+--------------+----------------+--------------+-------+---------------------+-----------+---------------------+
|            665353 |       282205 |          6448 | 客户需求单      | 20190107043162 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:39:18 |
|            665354 |       282205 |          6472 | 经办人授权书    | 20190107043162 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:39:18 |
|            665355 |       282205 |          6490 | 业务协议        | 20190107043162 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:39:18 |
|            665356 |       282205 |          6396 | 客户有效证件    | 20190107043162 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:39:18 |
|            665357 |       282205 |          6421 | 经办人身份证件  | 20190107043162 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:39:18 |
|            665358 |       282206 |          8166 | 业务协议        | 20181101188625 | 172000010006 | 本地虚拟专用网特殊套餐 | 100000000001 | 协 议变更       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:40:16 |
|            665359 |       282206 |          6488 | 业务协议        | 20181101188625 | 172000010006 | 本地虚拟专用网特殊套餐 | 100000000001 | 协 议变更       |            1 |     1 | 2019-02-17 20:02:22 |  10013249 | 2019-02-21 09:40:16 |
|            665360 |       282207 |          6448 | 客户需求单      | 20181217141979 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:23 |    747439 | 2019-02-19 14:16:55 |
|            665361 |       282207 |          6472 | 经办人授权书    | 20181217141979 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:23 |    747439 | 2019-02-19 14:16:55 |
|            665362 |       282207 |          6490 | 业务协议        | 20181217141979 | 172000010114 | 互联网宽带-专线版      | 192000011131 | 套 餐新装       |            1 |     1 | 2019-02-17 20:02:23 |    747439 | 2019-02-19 14:16:55 |
+-------------------+--------------+---------------+-----------------+----------------+--------------+------------------------+--------------+----------------+--------------+-------+---------------------+-----------+---------------------+
10 rows in set (0.18 sec)

mysql> select * from ins_audit_item a inner join (select ins_audit_item_id from ins_audit_item where state=1 order by create_date desc,ins_audit_item_id desc limit 500000,10) as temp where a.ins_audit_item_id = temp.ins_audit_item_id order by a.ins_audit_item_id;
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+-------------------+
| ins_audit_item_id | ins_audit_id | audit_item_id | audit_item_name | busi_ins_id    | busi_id | busi_name         | busi_oper_id | busi_oper_name                               | audit_result | state | create_date         | deal_oper    | done_date           | ins_audit_item_id |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+-------------------+
|            175490 |       115702 |          1272 | 经办人身份证件  | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |            175490 |
|            175491 |       115702 |          1200 | 客户有效证件    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |            175491 |
|            175492 |       115702 |          1455 | 客户需求单      | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |            175492 |
|            175493 |       115702 |          1542 | 经办人授权书    | 20171018000438 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:46 |       725307 | 2018-01-24 13:31:57 |            175493 |
|            175494 |       115703 |          1402 | 客户需求单      | 20171102000400 |  200233 | 物联网            |       200269 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:47 | 100000674226 | 2017-11-03 14:23:38 |            175494 |
|            175495 |       115704 |          1272 | 经办人身份证件  | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |            175495 |
|            175496 |       115704 |          1200 | 客户有效证件    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |            175496 |
|            175497 |       115704 |          1455 | 客户需求单      | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |            175497 |
|            175498 |       115704 |          1542 | 经办人授权书    | 20171102306407 |  200186 | 本地、跨省专线    |       200189 | 业务变更（除 带宽变更、月租费变更之外的变更） |            4 |     1 | 2017-11-02 14:50:47 | 100000679639 | 2017-11-14 12:52:04 |            175498 |
|            175499 |       115705 |          1472 | 客户需求单      | 20171102308428 |  200133 | 集团代付(GSM语音) |       200134 | 成员维护                                     |            4 |     1 | 2017-11-02 14:50:48 |     10009283 | 2017-11-24 15:17:23 |            175499 |
+-------------------+--------------+---------------+-----------------+----------------+---------+-------------------+--------------+----------------------------------------------+--------------+-------+---------------------+--------------+---------------------+-------------------+
10 rows in set (0.25 sec)
```
总结：排序分页查询，存在主键的情况下，根据其他字段排序需求，可以创建其他字段与where中字段的联合索引提高查询速度，最佳方案是采用内联合查询返回
Sending Data过程包括“收集 + 发送 数据”，mysql使用“索引”完成查询结束后，mysql得到了一堆的行id，如果有的列并不在索引中，mysql需要重新到“数据行”上将需要返回的数据读取出来返回个客户端。
普通索引与聚簇索引的映射关系，普通索引保存的是聚簇索引主键的值，这样不需要回表操作直接返回，效率更高
### MySQL执行SQL查询的过程
1. 客户端与服务端连接
2. 查询缓存  对比查询语句是否在缓存中，在则校验客户端权限
3. 查询优化处理，生成执行计划
包括解析SQL、预处理、优化SQL执行计划
解析SQL：对SQL进行语法校验，生成对应的解析树
预处理：预处理器根据一些Mysql规则进一步检查解析树是否合法，如数据表和数据列是否存在，解析列名和别名，是否有歧义。接下来预处理器会验证用户权限。查看用户是否有相应的操作权限
4. 查询执行引擎
根据存储引擎提供的API查询数据返回

对于select * from order where order_sn='201906051001' for update; 分析锁
1. 当order_sn为主键索引，同时存在记录时，在主键索引上的该记录加排他锁
2. 当order_sn为主键索引，不存在该条记录时，在最接近该条记录的两条记录间加间隙锁
3. 当order_sn为普通索引，且不为唯一索引时，在普通索引中所有对应记录上加锁，并且对这些记录的主键索引上的记录加锁，普通索引在加行级锁的同时加上间隙锁
4. 当order_sn为普通索引，且为唯一索引时，在普通索引的记录中加锁，同时在对应的主键索引上加锁
5. 当order_sn不是索引，且不存在记录时，则对扫描到的所有记录和间隙都加锁，如果不匹配行锁将会释放，只剩间隙锁